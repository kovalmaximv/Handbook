# Pods
Pod - минимальный юнит k8s, которым можно управлять. 

Pod это группа из одного (или более) контейнеров с общей спецификацией запуска. Как правило в под объединяют тесно
связанные между собой контейнеры. Например это могут быть такие сервисы, которые раннее запускались на одном хосте.

Однако стоит быть аккуратным и стараться придерживаться правила "1 под = 1 контейнер". Такой подход позволяет более
тонко настраивать масштабирование при нагрузках, но немного увеличивает сложность поддержки такой системы (получаем
большее число подов).

Обычно, поды не используются сами по себе. Вам не придется их создавать вручную, вместо этого вы будете работать с 
Deploy.

Каждый Pod предназначен для запуска одного экземпляра данного приложения. Если вы хотите масштабировать свое приложение 
по горизонтали вам следует использовать несколько Pods, по одному для каждого экземпляра. В Kubernetes это обычно 
называется репликацией. Про репликации мы поговорим в следующих md файлах.

## Ручная работа в терминале
Для запуска пода необходимо использовать следующую команду (создадим сразу под с tomcat):

```console
user@user-PC:~$ #kubectl run first-pod --image={IMAGE_NAME} --port={PORT}
user@user-PC:~$ kubectl run first-pod --image=tomcat --port=8080
pod/first-pod created
```

Теперь чтобы увидеть список наших подов, воспользуемся коммандой:
```console
user@user-PC:~$ kubectl get pods
NAME        READY   STATUS    RESTARTS   AGE
first-pod   1/1     Running   0          1m6s
```

Так же можно посмотреть всю информацию о поде:
```console
user@user-PC:~$ kubectl describe pods first-pod
# Куча полезной информации о поде и контейнере внутри 
```

Можно зайти внутрь пода, чтобы выполнить необходимые действия: 
```console
user@user-PC:~$ kubectl exec -it first-pod -- sh
# date
Thu Dec  1 04:32:34 PM UTC 2022
# exit
user@user-PC:~$ _
```

Чтобы посмотреть логи, необходимо выполнить:
```console
user@user-PC:~$ kubectl logs first-pod
01-Dec-2022 16:20:22.123 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version name:   Apache Tomcat/10.1.2
01-Dec-2022 16:20:22.125 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server built:          Nov 9 2022 15:47:04 UTC
...
01-Dec-2022 16:20:22.531 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in [93] milliseconds
```

Но что если мы захотим обратиться к контейнеру? На данном этапе Pod никак не прокидывает порты контейнера наружу.
Для этой цели используется **Service**, но речь о нем пойдет в следующих md файлах. Но в качестве дебагинга для подов
есть фича, позволяющая открыть порт контейнера:
```console
user@user-PC:~$ kubectl port-forward first-pod 1234:8080
Forwarding from 127.0.0.1:1234 -> 8080
Forwarding from [::1]:1234 -> 8080
```
Теперь можно обратиться к localhost:1234 и вы попадете на стартовую страницу Apache Tomcat. 

Для удаления пода используем:
```console
user@user-PC:~$ kubectl delete pods first-pod
pod "first-pod" deleted
```

## Использование манифестов
В энтерпрайзе, когда у тебя много подов, никто не работает с ними напрямую через терминал. Для этого используются 
манифесты. Манифест собирает в себе всю информацию, необходимую для создания и настройки пода, чтобы потом можно
было запустить манифест одной командой.

Пример манифеста можно посмотреть [здесь](./manifests/pod_manifest.yml)

Чтобы запустить манифест:
```console
user@user-PC:~$ kubectl apply -f pod_manifest.yml
pod/first-pod created
```

Любые изменения в манифесте требуют сначала удаления старого пода, а потом создание нового. Связано это с тем, что 
большая часть метаданных пода неизменяема.

Лишь немногие данные пода можно менять без удаления, например image контейнера. Если в манифесте изменился image, то 
достаточно еще раз запустить `kubectl apply` и под перезапустится с новым контейнером.

Чтобы удалить Pod созданный манифестом:
```console
user@user-PC:~$ kubectl delete -f pod_manifest.yml
pod "first-pod" deleted
```