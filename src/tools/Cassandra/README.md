# Cassandra
## Общее
Данные хранятся в cassandra денормализовано. Поэтому в cassandra можно получить данные только из одной таблицы
за запрос. Данные дублируются, нет join, зато мы получаем ускоренное чтение данных.

Partition не должен быть слишком большим. Лучше иметь много маленьких partition. Если у вас один partition весит 
пару ТБ, а другие пустые, то вы получаете hotspot. Даже добавление сотни новых серверов и partition не порешают проблему,
так как это не уменьшит существующий раздел. 

Изменить partition key нельзя. Если вас что-то перестало устраивать, все что остается - создать новую таблицу и 
мигрировать данные. 

## Data modeling
Для использования Cassandra критически важно правильно смоделировать данные, иначе Cassandra не будет приносить никакой 
пользы (или просто мешать). Для этого важно понимать нюансы моделирования. 

Реляционное моделирование начинается с самих данных. Их структура определяется свойствами бизнес процесса или 
реального мира. Затем на основе этих данных мы делаем модель (таблички и связи) в реляционной БД. Затем на основе модели
мы делаем приложение. Образно если у нас есть пользователи, корзина и товары, то и в приложении будет страница с 
пользователями, корзиной и товарами. 

![img.png](img/relational_modeling.png)

Моделирование данных для cassandra имеет противоположный подход: моделирование таблиц происходит исходя из приложения и 
представления данных, которые там необходимы. Все из-за того, что данные можно получить только по partition_id. То есть
в идеале придумать такое моделирование данных, чтобы необходимые данные можно было получить одним запросом. Поэтому query 
к бд тут рулят и понимание будущих query критически необходимо. Порой под каждый отдельный запрос делают отдельную 
таблицу (например отдельно таблица для поиска комментариев по видео и отдельная таблица для поиска комментариев по 
пользователю). 

![img.png](img/cassandra_modeling.png)

Итоги:
1) Проектируем таблицы для удовлетворения предполагаемых запросов
2) Partition key используется для группировки данных (по нему определяется partition), чтобы их было возможно получить 
одним запросом
3) Clustering key может добавить уникальности в primary key (чтобы избежать коллизий), либо обеспечить дополнительную 
фильтрацию или сортировку
4) Дополнительные поля только хранят данные, запросы по ним не поддерживаются

