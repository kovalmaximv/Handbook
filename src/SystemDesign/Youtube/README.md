# Youtube

## Требования к системе 
1) Возможность загрузки и просмотра видео
2) Возможность менять качество видео
3) Как можно более низкая стоимость обслуживания инфраструктуры
4) Доступность, масштабируемость, надежность

## Цифры
1) 5млн активных пользователей в день
2) Каждый пользователь смотрит 5 видео в день
3) 10% всех пользователей добавляет 1 видео в день
4) Предположим, средний размер видео 300мб
5) В день необходимо 5млн * 10% * 300МБ = 150ТБ места в хранилище

## High level design
Видео для просмотра запрашиваются с CDN, но это потребует очень больших затрат на инфраструктуру. В deep dive мы 
подумаем, как максимально снизить стоимость.

### Video uploading flow
Непонятные компоненты системы:  
**Metadata DB/cache** - метадата видео хранится в отдельной таблице и кэше.  
**Original Storage** - BLOB БД для хранения оригинала видео.  
**Transcoding servers** - конвертирует видео в форматы удобные для хранения и стриминга.  
**Transcoded storage** - BLOB БД для хранения конвертированных видео.  
**Completion queue** - по итогам конвертации записывается сообщение в очередь.  
**Completion handler** - сообщение с итогами конвертации записываются в БД метадаты.  
![img.png](img.png)

Флоу загрузки видео:
1) Видео загружается в Original BLOB storage
2) Transcoding servers конвертируют видео в другие форматы
3) По окончанию конвертации запускаются 2 параллельных процесса: сохранение в transcoded BLOB storage и запись итогов 
конвертации в очередь (которые после окажутся в metadata storage)

