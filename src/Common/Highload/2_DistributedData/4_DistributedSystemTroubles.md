# Проблемы распределенных систем
В этой главе будет обзор всех проблем, какие только могут возникнуть в распределенной системе. 

## Сбои и частичные отказы
В случае если программа работает на одном компьютере все довольно просто: или компьютер функционирует исправно и все 
команды программы будут выдавать детерминированный ответ, либо компьютер сломан и тогда отказ будет происходить на уровне
системы (мы не сможем пользоваться программой в целом). В случае с сетями все совсем иначе. Более нет ОС, которая будет 
отлавливать проблемы физического мира (плохой контакт, порча памяти, етс) и отказывать в выполнении всей программе 
верхнеуровнего. Со всеми проблемами сети приходится справляться самой программе. 

В распределенной системе некоторые части могут перестать работать неожиданно. Такая ситуация называется **частичным 
отказом**. Трудность состоит в их недетерминированности. К тому же, не всегда даже понятно, дошло сообщение до адресата
по сети или нет. 

Для решения данной проблемы надо встроить в программы механизмы обеспечения отказоустойчивости. Обработка сбоев должна
стать неотъемлемой частью архитектуры.

## Ненадежные сети
Интернет (и сети ЦОДа) представляют собой асинхронную сеть передачи данных. В подобных сетях узел отправляет сообщение
другим узлам по сети, но сеть не дает гарантий, когда он будет доставлен и будет ли доставлен вообще. При отправке 
запроса может произойти одна из следующих проблем:
1) Запрос может быть потерян (где-то оборвался кабель)
2) Запрос попадает в очередь и будет доставлен позже (перегруженность сети или получателя)
3) Отказ узла-получателя (отключение электропитания)
4) Удаленный узел временно перестал отвечать на запросы (чистка мусора)
5) Удаленный узел обработал запрос, но ответ был потерян при передаче по сети (неправильная настройка коммутатора)
6) Удаленный узел обработал запроса, но ответ задерживается при отправке по сети (перегруженность сети)

Из-за всех этих проблем отправитель даже не знает, был ли доставлен запрос? Или запрос обработан, но ответ не дошел до
отправителя? Узнать точную причину не получится, можно только констатировать факт, что отправитель не получил ответ.
Ответить на вопрос, почему это произошло - невозможно. 

Обычный способ решения этой проблемы - установить определенное время ожидания ответа, по истечению которого вы 
перестаете ждать ответ и предпринимаете какие-либо шаги (переотправка запроса, проверка его выполнения, етс). Если 
обработка сетевых ошибок отсутствует в коде приложения, то вас ожидают неприятные и трудноотловимые баги.

Каким должно быть время ожидания? Трудный вопрос, на который нет общего ответа. Слишком большой промежуток увеличит 
задержку для пользователя, более короткий промежуток влечет риск ошибочного объявления узла неработоспособным. Найти
свое время ожидания можно только исходя из статистических данных, которые необходимо собрать.

# Резюме
В распределенных системах есть широкий спектр проблем:
1) Потеря или задержка пакетов запроса и ответа, отправленных по сети
2) Часы одного узла могут быть рассинхронизированными с другими узлами системы
3) Выполнение процесса может быть остановлено в любой момент на существенный промежуток времени (например сборка мусора)

Возможность подобных частичных отказов - один из нюансов распределенной системы. Чем больше компонентов в системе, тем
больше частичных отказов в ней будет. Мы должны проектировать систему так, чтобы она умела обрабатывать частичные 
отказы. Для решения отказа сначала необходимо его обнаружить, но и с этим могут быть проблемы, так как нет 100% способа 
их обнаружить. 