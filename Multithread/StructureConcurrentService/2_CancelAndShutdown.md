# Отмена и выключение

Иногда нам требуется останавливать задачи и потоки раньше, чем они завершатся сами. В Java нет механизма 
принудительной остановки работы потока, но есть механизм _прерывания_ (interruption) - кооперативный механизм, 
который позволяет одному потоку попросить другой прекратить действовать.

Мы редко хотим, чтобы поток останавливался немедленно и бросал свое состояние в противоречивом состоянии. Избежать 
этой проблемы помогает механизм прерывания. Этот механизм так же обеспечивает большую гибкость, потому что задачный 
код лучше знает, что нужно сделать перед отменой потока. Запрашивающий отмену код может не владеть такой информацией. 

В этой главе описываются механизмы отмены (cancellation) и прерывания (interruption) и способы кодирования задач и 
служб, откликающихся на запросы об отмене.

## Отмена задачи
В этом параграфе обсудим отмену Runnable и Callable задач.

Задача, задуманная как отменяемая, должна иметь политику отмены:
1) Как другой код может запросить отмену
2) Когда задача проверяет наличие запроса на отмену
3) Какие действия задача предпринимает на запрос об отмене

Попробуем написать механизм отмены задачи, начиная с самого простого решения, с каждым разом будем немного 
улучшать решение. 

#### Флаг "запрошена отмена"

Самым простейшим механизмом отмены является установка флажка "запрошена отмена", который задача периодически проверяет. 
Рассмотрим пример такого подхода:

```java
public class PrimeGenerator implements Runnable {
    private final List<BigInteger> primes = new ArrayList<>();
    private volatile boolean cancelled; 
    
    public void run() {
        BigInteger p = BigInteger.ONE;
        while (!cancelled) {
            p = p.nextProbablePrime();
            synchronized (this) {
                primes.add(p);
            }
        }
    }
    
    public void cancel() {
        cancelled = true;
    }
    
    public synchronized List<BigInteger> get() {
        return new ArrayList<>(primes);
    }
}
```

#### Прерывание
